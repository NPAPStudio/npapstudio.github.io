"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[371],{51690:function(Ve,me,e){e.r(me),e.d(me,{default:function(){return at}});var Me=e(19632),ne=e.n(Me),Pe=e(97857),l=e.n(Pe),Te=e(15009),S=e.n(Te),be=e(99289),re=e.n(be),we=e(5574),w=e.n(we),xe=e(27496),_=e(52745),Ee=e(25278),ee=e(86250),se=e(14726),c=e(67294),Ze={sendBoxWrapper:"sendBoxWrapper___agwkd"},t=e(85893),De=Ee.Z.TextArea;function te(g){var v=g.onSend,i=g.sending,P=g.onHeightChanged,L=(0,c.useState)(""),C=w()(L,2),N=C[0],x=C[1],$=(0,c.useState)(!1),A=w()($,2),E=A[0],H=A[1];(0,c.useEffect)(function(){},[i]);var ae=function(T){x(T.target.value),P&&P(T.target.scrollHeight)},F=function(){i||(v(N),x(""))},ce=function(T){T.key==="Enter"&&!E&&!T.shiftKey&&!T.ctrlKey&&!T.altKey&&(T.preventDefault(),F()),(T.key==="Enter"&&T.altKey||T.key==="Enter"&&T.ctrlKey)&&x(N+`
`)},he=function(){H(!0)},ze=function(){H(!1)};return(0,t.jsx)(ee.Z,{style:{width:"100%"},justify:"center",align:"center",children:(0,t.jsxs)(ee.Z,{className:Ze.sendBoxWrapper,children:[(0,t.jsx)(De,{rows:1,placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",autoSize:{minRows:1,maxRows:5},onChange:ae,onKeyDown:ce,onCompositionStart:he,onCompositionEnd:ze,value:N}),(0,t.jsx)(se.ZP,{style:{marginLeft:"10px"},type:"primary",icon:i?(0,t.jsx)(_.Z,{}):(0,t.jsx)(xe.Z,{}),shape:"circle",onClick:F})]})})}var K=te,J=e(88001),Le=e(80882),I=e(47988),Ne={modelSwitcher:"modelSwitcher___q1h_3"},Be=function(v){var i=v.currentModel,P=v.onChange,L=(0,c.useState)(""),C=w()(L,2),N=C[0],x=C[1];(0,c.useEffect)(function(){var E=J.aH.find(function(H){return H.key===i});E&&x(E.label)},[i]);var $=function(H){var ae=H.key,F=J.aH.find(function(ce){return ce.key===ae});F&&(x(F.label),P&&P(ae))},A={onClick:$,items:J.aH.map(function(E){return{key:E.key,label:E.label}})};return(0,t.jsx)(I.Z,{menu:A,className:Ne.modelSwitcher,children:(0,t.jsxs)(se.ZP,{size:"large",style:{border:"none"},children:[N," ",(0,t.jsx)(Le.Z,{})]})})},ke=Be,Ae=ke,V=e(16165),h=function(){return(0,t.jsx)("svg",{viewBox:"0 0 1024 1024",width:"1em",height:"1em",fill:"currentColor",children:(0,t.jsx)("path",{d:"M89.6 806.4h844.8V217.6H89.6v588.8zM0 128h1024v768H0V128z m242.816 577.536L192 654.72l154.304-154.368L192 346.048l50.816-50.816L448 500.352l-205.184 205.184z m584.32 13.248H512V640h315.072v78.72z"})})},n=function(v){return(0,t.jsx)(V.Z,l()({component:h},v))},m={TerminalIcon:n},j=null,a=null,u=e(67984),d=e(9981),k=e(35312),M=e(21612),U={mainChatLayout:"mainChatLayout___UtmAb",mainChatLayoutHeader:"mainChatLayoutHeader___kNAhD",mainChatLayoutContent:"mainChatLayoutContent___soSU_",mainChatLayoutFooter:"mainChatLayoutFooter___PcPty"},p=e(87547),Q=e(8718),ie=e(13769),oe=e.n(ie),fe=e(57132),pe=e(84526),ge=e(93179),Ce=e(68806),W={codeWrapper:"codeWrapper___TPzJT",copyButton:"copyButton___X2UZT"},ye=["children","className"],Se=function(v){var i=v.code,P=function(){navigator.clipboard.writeText(i).then(function(){},function(C){console.error("Failed to copy code: ",C)})};return(0,t.jsx)(se.ZP,{icon:(0,t.jsx)(fe.Z,{}),size:"small",type:"text",className:W.copyButton,onClick:P})},le=function(v){var i=v.content;return(0,t.jsx)(pe.U,{components:{code:function(L){var C=L.children,N=L.className,x=oe()(L,ye),$=/language-(\w+)/.exec(N||""),A=String(C).replace(/\n$/,"");return $?(0,t.jsxs)("div",{className:W.codeWrapper,children:[(0,t.jsx)(Se,{code:A}),(0,t.jsx)(ge.Z,l()(l()({},x),{},{PreTag:"div",language:$[1],style:Ce.Z,wrapLines:!0,ref:c.createRef(),children:A}))]}):(0,t.jsx)("code",l()(l()({},x),{},{className:N,children:C}))}},children:i})},Re=le,r=Re,D={mainMsgList:"mainMsgList___yzBZj",chatContent:"chatContent___rJQDh",userContent:"userContent___LOQQq",assistantContent:"assistantContent___iIkx1"};function ue(g){var v=g.messages;return(0,c.useEffect)(function(){var i=document.querySelector(".".concat(D.mainMsgList));i&&(i.scrollTop=i.scrollHeight)},[v]),(0,t.jsx)("div",{className:D.mainMsgList,children:v.map(function(i,P){return(0,t.jsxs)(ee.Z,{gap:"middle",justify:i.isUser?"end":"start",align:"start",className:D.chatItem,children:[i.isUser?"":(0,t.jsx)(Q.C,{size:36,icon:(0,t.jsx)(p.Z,{})}),(0,t.jsx)("span",{className:"".concat(D.chatContent," ").concat(i.isUser?D.userContent:D.assistantContent),children:(0,t.jsx)(r,{content:i.content})})]},P)})})}var de=ue,z=e(22913),Y={promptEditor:"promptEditor___I7WRr",systemPromotTextarea:"systemPromotTextarea___xJfXE"};function Ue(g){var v=g.prompt,i=g.onPromptChange,P=function(C){i(C.target.value)};return(0,t.jsxs)(ee.Z,{className:Y.promptEditor,vertical:!0,children:[(0,t.jsx)("h3",{children:"System Prompt"}),(0,t.jsx)(z.Z,{className:Y.systemPromotTextarea,value:v,onChange:P})]})}var G=Ue,O=M.Z.Header,Qe=M.Z.Footer,Ye=M.Z.Sider,Xe=M.Z.Content,qe=function(v){var i,P=v.model,L=(0,c.useState)(!1),C=w()(L,2),N=C[0],x=C[1],$=(0,c.useState)(P),A=w()($,2),E=A[0],H=A[1],ae=(0,c.useState)([]),F=w()(ae,2),ce=F[0],he=F[1],ze=(0,k.useParams)(),R=ze.id,T=(0,k.useSearchParams)(),nt=w()(T,1),rt=nt[0],st=(0,c.useState)(rt.get("bot")),We=w()(st,2),X=We[0],Oe=We[1],it=(0,c.useState)(new u.Z(X)),Ge=w()(it,2),ve=Ge[0],He=Ge[1],ot=(0,c.useRef)(new d.Z(R)),lt=(0,c.useState)(ot.current),ut=w()(lt,1),s=ut[0],dt=(0,c.useState)(null),$e=w()(dt,2),Ie=$e[0],Fe=$e[1],ct=function(Z){H(Z),s.chat&&s.changeModel(Z)},Ke=function(){var f=re()(S()().mark(function Z(){var b,y,B;return S()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,!ve){o.next=8;break}if(!(X||(b=s.chat)!==null&&b!==void 0&&b.botId)){o.next=8;break}return ve.setId(X||((y=s.chat)===null||y===void 0?void 0:y.botId)),o.next=6,ve.get();case 6:B=o.sent,He(B);case 8:o.next=14;break;case 10:o.prev=10,o.t0=o.catch(0),Oe(null),He(new u.Z);case 14:case"end":return o.stop()}},Z,null,[[0,10]])}));return function(){return f.apply(this,arguments)}}(),ht=function(){var f=re()(S()().mark(function Z(){var b,y,B,je,o;return S()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(!R){q.next=11;break}return s.setId(R),q.next=4,s.init(E);case 4:if(je=s.messages.map(function(ft){return ft}),H((b=s.chat)===null||b===void 0?void 0:b.model),he(je),s!=null&&(y=s.chat)!==null&&y!==void 0&&y.title){q.next=10;break}return q.next=10,s.generateChatName();case 10:(B=s.chat)!==null&&B!==void 0&&B.botId?(Oe((o=s.chat)===null||o===void 0?void 0:o.botId.toString()),Ke()):(Oe(null),He(new u.Z));case 11:case"end":return q.stop()}},Z)}));return function(){return f.apply(this,arguments)}}();(0,c.useEffect)(function(){ht()},[R]),(0,c.useEffect)(function(){Ke()},[X]),(0,c.useEffect)(function(){var f=function(b){Fe(function(y){var B=y?l()(l()({},y),{},{content:y.content+b.detail}):{chatId:s.id,content:b.detail,createdAt:new Date,isUser:!1};return B})};return s.addEventListener("messageReceived",f),function(){s.removeEventListener("messageReceived",f)}},[s]),(0,c.useEffect)(function(){Ie&&he(function(f){return f.length>0&&!f[f.length-1].isUser?[].concat(ne()(f.slice(0,f.length-1)),[Ie]):[].concat(ne()(f),[Ie])})},[Ie]);var vt=(0,t.jsx)(n,{style:{fontSize:"18px",color:"#999"}}),mt=function(){var f=re()(S()().mark(function Z(b){var y,B;return S()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!N){o.next=2;break}return o.abrupt("return");case 2:if(x(!0),y=!1,s.chat){o.next=9;break}return X&&s.setBot(parseInt(X)),o.next=8,s.init(E);case 8:y=!0;case 9:return B={chatId:s.id,content:b,createdAt:new Date,isUser:!0},he(function(Je){return[].concat(ne()(Je),[B])}),Fe({chatId:s.id,content:"",createdAt:new Date,isUser:!1}),o.next=14,s.sendMessage(b);case 14:x(!1),y&&k.history.push("/chat/".concat(s.id));case 16:case"end":return o.stop()}},Z)}));return function(b){return f.apply(this,arguments)}}();return(0,t.jsxs)(M.Z,{style:{minHeight:"100vh"},children:[(0,t.jsxs)(M.Z,{className:U.mainChatLayout,children:[(0,t.jsx)(O,{className:U.mainChatLayoutHeader,children:X?(0,t.jsx)("h2",{children:ve.title}):(0,t.jsx)(Ae,{currentModel:E,onChange:ct})}),(0,t.jsx)(Xe,{className:U.mainChatLayoutContent,children:(0,t.jsx)(de,{messages:ce})}),(0,t.jsx)(Qe,{className:U.mainChatLayoutFooter,children:(0,t.jsx)(K,{onSend:mt,sending:N})})]}),(0,t.jsx)(Ye,{style:{backgroundColor:"rgba(0,0,0,0)",borderLeft:"1px solid #f0f0f0"},collapsible:!0,defaultCollapsed:!0,reverseArrow:!0,width:500,collapsedWidth:0,zeroWidthTriggerStyle:{width:30,height:30,borderRadius:0,top:0,left:-30,backgroundColor:"rgba(0,0,0,0)"},trigger:vt,children:(0,t.jsx)(G,{prompt:((i=s.chat)===null||i===void 0?void 0:i.systemPrompt)||ve.systemPrompt,onPromptChange:function(){}})})]})},_e=qe,et=_e,tt=function(){var v=J.pk;return(0,t.jsx)(et,{model:v})},at=tt},9981:function(Ve,me,e){e.d(me,{Z:function(){return Be}});var Me=e(64599),ne=e.n(Me),Pe=e(15009),l=e.n(Pe),Te=e(99289),S=e.n(Te),be=e(12444),re=e.n(be),we=e(72004),w=e.n(we),xe=e(25098),_=e.n(xe),Ee=e(31996),ee=e.n(Ee),se=e(26037),c=e.n(se),Ze=e(12665),t=e.n(Ze),De=e(9783),te=e.n(De),K=e(88001),J={titleGeneratorModel:"gpt-4o-mini",titleGeneratorPrompt:"You are a conversation management robot. What the user will send to you is the details of the conversation between the user and an AI. You need to generate a short title that can summarize the content based on the content of the conversation. Output only text, without quotes and markdown format"},Le=e(57632),I=e(41467),Ne=function(ke){ee()(V,ke);var Ae=c()(V);function V(h){var n;return re()(this,V),n=Ae.call(this),te()(_()(n),"id",void 0),te()(_()(n),"chat",void 0),te()(_()(n),"botId",void 0),te()(_()(n),"messages",[]),h?n.id=h:n.id=(0,Le.Z)(),n}return w()(V,[{key:"setId",value:function(n){this.id=n}},{key:"setBot",value:function(n){this.botId=n}},{key:"init",value:function(){var h=S()(l()().mark(function m(j){var a;return l()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,I.db.getData("Chats",this.id);case 2:if(this.chat=d.sent,this.chat!==null){d.next=15;break}if(this.chat={id:this.id,title:"",createdAt:new Date,systemPrompt:"",model:j||K.pk},!this.botId){d.next=11;break}return this.chat.botId=this.botId,d.next=9,I.db.getData("Bots",this.botId);case 9:a=d.sent,a&&(this.chat.systemPrompt=a.systemPrompt,this.chat.model=a.model);case 11:return d.next=13,I.db.addData("Chats",this.chat);case 13:d.next=18;break;case 15:return d.next=17,I.db.getAllDataByIndex("Messages","chatId",this.id);case 17:this.messages=d.sent.slice(-K.xf*2);case 18:case"end":return d.stop()}},m,this)}));function n(m){return h.apply(this,arguments)}return n}()},{key:"changeModel",value:function(){var h=S()(l()().mark(function m(j){return l()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.chat){u.next=2;break}throw new Error("Chat is not initialized");case 2:return this.chat.model=j,u.next=5,I.db.updateData("Chats",this.chat);case 5:case"end":return u.stop()}},m,this)}));function n(m){return h.apply(this,arguments)}return n}()},{key:"renameChat",value:function(){var h=S()(l()().mark(function m(j){return l()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.chat){u.next=2;break}throw new Error("Chat is not initialized");case 2:return this.chat.title=j,u.next=5,I.db.updateData("Chats",this.chat);case 5:case"end":return u.stop()}},m,this)}));function n(m){return h.apply(this,arguments)}return n}()},{key:"deleteChat",value:function(){var h=S()(l()().mark(function m(){return l()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this.chat){a.next=2;break}throw new Error("Chat is not initialized");case 2:return a.next=4,I.db.deleteData("Chats",this.chat.id);case 4:return a.next=6,I.db.deleteDataByIndex("Messages","chatId",this.chat.id);case 6:case"end":return a.stop()}},m,this)}));function n(){return h.apply(this,arguments)}return n}()},{key:"sendMessage",value:function(){var h=S()(l()().mark(function m(j){var a,u=this,d,k,M,U,p,Q,ie,oe,fe,pe,ge,Ce,W,ye,Se,le;return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(d=JSON.parse(localStorage.getItem("openai_config")||"{}"),this.chat){r.next=3;break}throw new Error("Chat is not initialized");case 3:return k={chatId:this.chat.id,content:j,createdAt:new Date,isUser:!0},this.messages.push(k),this.messages.length>K.DI*2&&this.messages.shift(),r.next=8,I.db.addData("Messages",k);case 8:return M=[{role:"system",content:this.chat.systemPrompt}],this.messages.slice(-K.DI*2).forEach(function(D){M.push({role:D.isUser?"user":"assistant",content:D.content})}),r.next=12,fetch("".concat(d.end_point,"/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(d.api_key)},body:JSON.stringify({model:this.chat.model,messages:M,stream:!0})});case 12:U=r.sent,p=(a=U.body)===null||a===void 0?void 0:a.getReader(),Q=new TextDecoder("utf-8"),ie="";case 16:return r.next=19,p.read();case 19:if(oe=r.sent,fe=oe.done,pe=oe.value,!fe){r.next=24;break}return r.abrupt("break",46);case 24:ge=Q.decode(pe,{stream:!0}),Ce=ge.split(`
`),W=ne()(Ce),r.prev=27,Se=l()().mark(function D(){var ue,de,z,Y;return l()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(ue=ye.value,!ue.startsWith("data: ")){G.next=8;break}if(de=ue.slice(6),de!=="[DONE]"){G.next=5;break}return G.abrupt("return",1);case 5:z=function(){try{return JSON.parse(de)}catch(O){return{}}}(),Y=function(){if(z!=null&&z.choices){var O;return z==null||(O=z.choices[0])===null||O===void 0||(O=O.delta)===null||O===void 0?void 0:O.content}return null}(),Y&&(ie+=Y,u.dispatchEvent(new CustomEvent("messageReceived",{detail:Y})));case 8:case"end":return G.stop()}},D)}),W.s();case 30:if((ye=W.n()).done){r.next=36;break}return r.delegateYield(Se(),"t0",32);case 32:if(!r.t0){r.next=34;break}return r.abrupt("break",36);case 34:r.next=30;break;case 36:r.next=41;break;case 38:r.prev=38,r.t1=r.catch(27),W.e(r.t1);case 41:return r.prev=41,W.f(),r.finish(41);case 44:r.next=16;break;case 46:return le={chatId:this.chat.id,content:ie,createdAt:new Date,isUser:!1},this.messages.push(le),this.messages.length>K.DI*2&&this.messages.shift(),r.next=51,I.db.addData("Messages",le);case 51:case"end":return r.stop()}},m,this,[[27,38,41,44]])}));function n(m){return h.apply(this,arguments)}return n}()},{key:"generateChatName",value:function(){var h=S()(l()().mark(function m(){var j,a,u,d,k,M;return l()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(j=JSON.parse(localStorage.getItem("openai_config")||"{}"),this.chat){p.next=3;break}throw new Error("Chat is not initialized");case 3:return a=[{role:"system",content:J.titleGeneratorPrompt}],u="system: ".concat(this.chat.systemPrompt,`
`),this.messages.forEach(function(Q){u+="".concat(Q.isUser?"user":"assistant",": ").concat(Q.content,`
`)}),a.push({role:"user",content:u}),p.next=9,fetch("".concat(j.end_point,"/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(j.api_key)},body:JSON.stringify({model:J.titleGeneratorModel,messages:a,stream:!1})});case 9:return d=p.sent,p.next=12,d.json();case 12:return k=p.sent,M=k.choices[0].message.content,this.chat.title=M,p.next=17,I.db.updateData("Chats",this.chat);case 17:return p.abrupt("return",M);case 18:case"end":return p.stop()}},m,this)}));function n(){return h.apply(this,arguments)}return n}()}],[{key:"getChats",value:function(){var h=S()(l()().mark(function m(){return l()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,I.db.getAllData("Chats");case 3:return a.abrupt("return",a.sent);case 6:return a.prev=6,a.t0=a.catch(0),console.error("Error getting chats",a.t0),a.abrupt("return",[]);case 10:case"end":return a.stop()}},m,null,[[0,6]])}));function n(){return h.apply(this,arguments)}return n}()}]),V}(t()(EventTarget)),Be=Ne}}]);
