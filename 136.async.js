"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[136],{65136:function(Ce,te,t){t.d(te,{z:function(){return xe.z},Z:function(){return tt}});var ne=t(19632),_=t.n(ne),ae=t(97857),M=t.n(ae),re=t(15009),C=t.n(re),se=t(99289),$=t.n(se),oe=t(5574),I=t.n(oe),ie=t(27496),f=t(52745),Z=t(25278),E=t(86250),z=t(14726),o=t(67294),m={sendBoxWrapper:"sendBoxWrapper___agwkd"},e=t(85893),g=Z.Z.TextArea;function n(b){var l=b.onSend,c=b.sending,D=b.onHeightChanged,B=(0,o.useState)(""),s=I()(B,2),y=s[0],j=s[1],T=(0,o.useState)(!1),R=I()(T,2),w=R[0],O=R[1];(0,o.useEffect)(function(){},[c]);var W=function(S){j(S.target.value),D&&D(S.target.scrollHeight)},H=function(){c||(l(y),j(""))},G=function(S){S.key==="Enter"&&!w&&!S.shiftKey&&!S.ctrlKey&&!S.altKey&&(S.preventDefault(),H()),(S.key==="Enter"&&S.altKey||S.key==="Enter"&&S.ctrlKey)&&j(y+`
`)},V=function(){O(!0)},X=function(){O(!1)};return(0,e.jsx)(E.Z,{style:{width:"100%"},justify:"center",align:"center",children:(0,e.jsxs)(E.Z,{className:m.sendBoxWrapper,children:[(0,e.jsx)(g,{rows:1,placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",autoSize:{minRows:1,maxRows:5},onChange:W,onKeyDown:G,onCompositionStart:V,onCompositionEnd:X,value:y}),(0,e.jsx)(z.ZP,{style:{marginLeft:"10px"},type:"primary",icon:c?(0,e.jsx)(f.Z,{}):(0,e.jsx)(ie.Z,{}),shape:"circle",onClick:H})]})})}var i=n,u=t(88001),A=t(80882),L=t(47988),be={modelSwitcher:"modelSwitcher___q1h_3"},je=function(l){var c=l.currentModel,D=l.onChange,B=(0,o.useState)(""),s=I()(B,2),y=s[0],j=s[1];(0,o.useEffect)(function(){var w=u.aH.find(function(O){return O.key===c});w&&j(w.label)},[c]);var T=function(O){var W=O.key,H=u.aH.find(function(G){return G.key===W});H&&(j(H.label),D&&D(W))},R={onClick:T,items:u.aH.map(function(w){return{key:w.key,label:w.label}})};return(0,e.jsx)(L.Z,{menu:R,className:be.modelSwitcher,children:(0,e.jsxs)(z.ZP,{size:"large",style:{border:"none"},children:[y," ",(0,e.jsx)(A.Z,{})]})})},Se=je,Me=Se,Ee=t(16165),De=function(){return(0,e.jsx)("svg",{viewBox:"0 0 1024 1024",width:"1em",height:"1em",fill:"currentColor",children:(0,e.jsx)("path",{d:"M89.6 806.4h844.8V217.6H89.6v588.8zM0 128h1024v768H0V128z m242.816 577.536L192 654.72l154.304-154.368L192 346.048l50.816-50.816L448 500.352l-205.184 205.184z m584.32 13.248H512V640h315.072v78.72z"})})},ce=function(l){return(0,e.jsx)(Ee.Z,M()({component:De},l))},vt={TerminalIcon:ce},_t=null,ft=null,xe=t(41467),ue=t(67984),Be=t(9981),F=t(21612),U={chatLayout:"chatLayout___mSyN7",mainChatLayout:"mainChatLayout___UtmAb",mainChatLayoutHeader:"mainChatLayoutHeader___kNAhD",mainChatLayoutContent:"mainChatLayoutContent___soSU_",mainChatLayoutFooter:"mainChatLayoutFooter___PcPty",mainChatRightSidebarTrigger:"mainChatRightSidebarTrigger___MmoUG",GenerateBot:"GenerateBot___n17Sp"},Pe=t(48689),Ie=t(87547),Ae=t(89705),Le=t(8718),Te=t(13769),we=t.n(Te),Re=t(57132),Oe=t(84526),Ze=t(93179),ke=t(68806),he={codeWrapper:"codeWrapper___TPzJT",copyButton:"copyButton___X2UZT"},Ue=["children","className"],We=function(l){var c=l.code,D=function(){navigator.clipboard.writeText(c).then(function(){},function(s){console.error("Failed to copy code: ",s)})};return(0,e.jsx)(z.ZP,{icon:(0,e.jsx)(Re.Z,{}),size:"small",type:"text",className:he.copyButton,onClick:D})},He=function(l){var c=l.content;return(0,e.jsx)(Oe.U,{components:{code:function(B){var s=B.children,y=B.className,j=we()(B,Ue),T=/language-(\w+)/.exec(y||""),R=String(s).replace(/\n$/,"");return T?(0,e.jsxs)("div",{className:he.codeWrapper,children:[(0,e.jsx)(We,{code:R}),(0,e.jsx)(Ze.Z,M()(M()({},j),{},{PreTag:"div",language:T[1],style:ke.Z,wrapLines:!0,ref:o.createRef(),children:R}))]}):(0,e.jsx)("code",M()(M()({},j),{},{className:y,children:s}))}},children:c})},Ne=He,Ke=Ne,k={mainMsgList:"mainMsgList___yzBZj",chatItem:"chatItem___U_uOO",chatContent:"chatContent___rJQDh",moreActionBtn:"moreActionBtn___aiJEA",userContent:"userContent___LOQQq",assistantContent:"assistantContent___iIkx1",avatar:"avatar___uSme5"};function $e(b){var l=b.messages,c=b.handleMsgAction,D=function(y,j){c&&c(y,j)},B=[{icon:(0,e.jsx)(Pe.Z,{}),key:"delete",danger:!0,label:"Delete"}];return(0,o.useEffect)(function(){var s=document.querySelector(".".concat(k.mainMsgList));s&&(s.scrollTop=s.scrollHeight)},[l]),(0,e.jsx)("div",{className:k.mainMsgList,children:l.map(function(s,y){return(0,e.jsxs)(E.Z,{gap:"middle",justify:s.isUser?"end":"start",align:"start",className:k.chatItem,children:[s.isUser?"":(0,e.jsx)(Le.C,{size:36,icon:(0,e.jsx)(Ie.Z,{}),className:k.avatar}),(0,e.jsxs)("span",{className:"".concat(k.chatContent," ").concat(s.isUser?k.userContent:k.assistantContent),children:[(0,e.jsx)(Ke,{content:s.content}),(0,e.jsx)(L.Z,{menu:{selectable:!1,onClick:function(T){D(T.key,s.id)},items:B},trigger:["hover"],className:k.moreActionBtn,children:(0,e.jsx)(z.ZP,{icon:(0,e.jsx)(Ae.Z,{}),size:"small",type:"text"})})]})]},y)})})}var ze=$e,Fe=t(22913),me={promptEditor:"promptEditor___I7WRr",systemPromotTextarea:"systemPromotTextarea___xJfXE"};function Ge(b){var l=b.prompt,c=b.onPromptChange,D=function(s){c(s.target.value)};return(0,e.jsxs)(E.Z,{className:me.promptEditor,vertical:!0,children:[(0,e.jsx)("h3",{children:"System Prompt"}),(0,e.jsx)(Fe.Z,{className:me.systemPromotTextarea,value:l,onChange:D})]})}var Je=Ge,Ve=F.Z.Header,Qe=F.Z.Footer,Xe=F.Z.Sider,Ye=F.Z.Content,qe=function(l){var c,D=l.chat,B=l.bot,s=l.model,y=l.type,j=l.chatIdUpdate,T=l.messageHandler,R=(0,o.useState)(!1),w=I()(R,2),O=w[0],W=w[1],H=(0,o.useState)(s),G=I()(H,2),V=G[0],X=G[1],J=(0,o.useState)([]),S=I()(J,2),nt=S[0],Y=S[1],q=D,at=(0,o.useState)(B),pe=I()(at,2),N=pe[0],le=pe[1],rt=(0,o.useState)(new ue.Z(N)),ve=I()(rt,2),Q=ve[0],de=ve[1],st=(0,o.useRef)(new Be.Z(q)),ot=(0,o.useState)(st.current),it=I()(ot,1),a=it[0],ut=(0,o.useState)(null),_e=I()(ut,2),ee=_e[0],fe=_e[1],lt=function(p){X(p),a.chat&&a.changeModel(p)},ge=function(){var h=$()(C()().mark(function p(){var v,d,x;return C()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!Q){r.next=8;break}if(!(N||(v=a.chat)!==null&&v!==void 0&&v.botId)){r.next=8;break}return Q.setId(N||((d=a.chat)===null||d===void 0?void 0:d.botId)),r.next=6,Q.get();case 6:x=r.sent,de(x);case 8:r.next=14;break;case 10:r.prev=10,r.t0=r.catch(0),le(void 0),de(new ue.Z);case 14:case"end":return r.stop()}},p,null,[[0,10]])}));return function(){return h.apply(this,arguments)}}(),dt=function(){var h=$()(C()().mark(function p(){var v,d,x,P,r;return C()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(!q){K.next=11;break}return a.setId(q),K.next=4,a.init(y,V);case 4:if(P=a.messages.map(function(pt){return pt}),X((v=a.chat)===null||v===void 0?void 0:v.model),Y(P),a!=null&&(d=a.chat)!==null&&d!==void 0&&d.title){K.next=10;break}return K.next=10,a.generateChatName();case 10:(x=a.chat)!==null&&x!==void 0&&x.botId?(le((r=a.chat)===null||r===void 0?void 0:r.botId),ge()):(le(void 0),de(new ue.Z));case 11:case"end":return K.stop()}},p)}));return function(){return h.apply(this,arguments)}}();(0,o.useEffect)(function(){dt()},[q]),(0,o.useEffect)(function(){ge()},[N]),(0,o.useEffect)(function(){var h=function(d){fe(function(x){var P=x?M()(M()({},x),{},{content:x.content+d.detail}):{chatId:a.id,content:d.detail,createdAt:new Date,isUser:!1};return P})},p=function(d){T&&T(d.detail)};return a.addEventListener("messageReceived",h),a.addEventListener("messageReceivedDone",p),function(){a.removeEventListener("messageReceived",h),a.addEventListener("messageReceivedDone",p)}},[a]),(0,o.useEffect)(function(){ee&&Y(function(h){return h.length>0&&!h[h.length-1].isUser?[].concat(_()(h.slice(0,h.length-1)),[ee]):[].concat(_()(h),[ee])})},[ee]);var ct=(0,e.jsx)(ce,{className:U.mainChatRightSidebarTrigger}),ht=function(){var h=$()(C()().mark(function p(v){var d,x;return C()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!O){r.next=2;break}return r.abrupt("return");case 2:if(v){r.next=4;break}return r.abrupt("return");case 4:if(W(!0),d=!1,a.chat){r.next=11;break}return N&&a.setBot(N),r.next=10,a.init(y,V);case 10:d=!0;case 11:return x={chatId:a.id,content:v,createdAt:new Date,isUser:!0},Y(function(ye){return[].concat(_()(ye),[x])}),fe({chatId:a.id,content:"",createdAt:new Date,isUser:!1}),r.next=16,a.sendMessage(v);case 16:W(!1),d&&j&&a.id&&j(a.id);case 18:case"end":return r.stop()}},p)}));return function(v){return h.apply(this,arguments)}}(),mt=function(){var h=$()(C()().mark(function p(v,d){return C()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(v!=="delete"){P.next=5;break}if(!d){P.next=5;break}return P.next=4,a.deleteMessage(d);case 4:Y(a.messages.map(function(r){return r}));case 5:case"end":return P.stop()}},p)}));return function(v,d){return h.apply(this,arguments)}}();return(0,e.jsxs)(F.Z,{className:"".concat(U.chatLayout," ").concat(U[y]),children:[(0,e.jsxs)(F.Z,{className:U.mainChatLayout,children:[(0,e.jsx)(Ve,{className:U.mainChatLayoutHeader,children:N?(0,e.jsx)("h2",{children:Q.title}):(0,e.jsx)(Me,{currentModel:V,onChange:lt})}),(0,e.jsx)(Ye,{className:U.mainChatLayoutContent,children:(0,e.jsx)(ze,{messages:nt,handleMsgAction:mt})}),(0,e.jsx)(Qe,{className:U.mainChatLayoutFooter,children:(0,e.jsx)(i,{onSend:ht,sending:O})})]}),(0,e.jsx)(Xe,{style:{backgroundColor:"rgba(0,0,0,0)",borderLeft:"1px solid #f0f0f0"},collapsible:!0,defaultCollapsed:!0,reverseArrow:!0,width:500,collapsedWidth:0,zeroWidthTriggerStyle:{width:30,height:30,borderRadius:0,top:0,left:-30,backgroundColor:"rgba(0,0,0,0)"},trigger:ct,children:(0,e.jsx)(Je,{prompt:((c=a.chat)===null||c===void 0?void 0:c.systemPrompt)||Q.systemPrompt,onPromptChange:function(){}})})]})},et=qe,tt=et},67984:function(Ce,te,t){var ne=t(15009),_=t.n(ne),ae=t(97857),M=t.n(ae),re=t(99289),C=t.n(re),se=t(12444),$=t.n(se),oe=t(72004),I=t.n(oe),ie=t(9783),f=t.n(ie),Z=t(88001),E=t(41467),z=function(){function o(m){$()(this,o),f()(this,"id",void 0),f()(this,"title",void 0),f()(this,"createdAt",void 0),f()(this,"systemPrompt",void 0),f()(this,"model",void 0),f()(this,"helperChatId",void 0),f()(this,"frequency_penalty",void 0),f()(this,"presence_penalty",void 0),f()(this,"max_tokens",void 0),f()(this,"temperature",void 0),f()(this,"top_p",void 0),f()(this,"stop",void 0),f()(this,"maxDisplayRounds",void 0),f()(this,"maxMemoryRounds",void 0),m?this.id=parseInt(m):(this.title="",this.createdAt=new Date,this.systemPrompt="",this.model=Z.pk,this.frequency_penalty=0,this.presence_penalty=0,this.temperature=1,this.top_p=1,this.stop=[],this.maxDisplayRounds=Z.xf,this.maxMemoryRounds=Z.DI)}return I()(o,[{key:"setId",value:function(e){this.id=parseInt(e)}},{key:"create",value:function(){var m=C()(_()().mark(function g(n){var i,u;return _()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,E.db.addData("Bots",n);case 2:return i=L.sent,this.id=i,u=M()(M()({},n),{},{botId:this.id,updateAt:new Date}),L.next=7,E.db.addData("BotHistories",u);case 7:return L.next=9,this.get();case 9:return L.abrupt("return",L.sent);case 10:case"end":return L.stop()}},g,this)}));function e(g){return m.apply(this,arguments)}return e}()},{key:"update",value:function(){var m=C()(_()().mark(function g(n){var i;return _()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this.id){A.next=2;break}throw new Error("Bot id is required");case 2:return A.next=4,E.db.updateData("Bots",M()(M()({},n),{},{id:this.id}));case 4:return i=M()(M()({},n),{},{botId:this.id,updateAt:new Date}),A.next=7,E.db.addData("BotHistories",i);case 7:return A.next=9,this.get();case 9:return A.abrupt("return",A.sent);case 10:case"end":return A.stop()}},g,this)}));function e(g){return m.apply(this,arguments)}return e}()},{key:"delete",value:function(){var m=C()(_()().mark(function g(){return _()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.id){i.next=2;break}throw new Error("Bot id is required");case 2:return i.next=4,E.db.deleteData("Bots",this.id);case 4:return i.next=6,E.db.deleteDataByIndex("BotHistories","botId",this.id);case 6:case"end":return i.stop()}},g,this)}));function e(){return m.apply(this,arguments)}return e}()},{key:"get",value:function(){var m=C()(_()().mark(function g(){var n;return _()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.id){u.next=2;break}throw new Error("Bot id is required");case 2:return u.next=4,E.db.getData("Bots",this.id);case 4:return n=u.sent,this.title=(n==null?void 0:n.title)||"",this.createdAt=(n==null?void 0:n.createdAt)||new Date,this.systemPrompt=(n==null?void 0:n.systemPrompt)||"",this.model=(n==null?void 0:n.model)||Z.pk,this.frequency_penalty=(n==null?void 0:n.frequency_penalty)||0,this.presence_penalty=(n==null?void 0:n.presence_penalty)||0,this.temperature=(n==null?void 0:n.temperature)||1,this.top_p=(n==null?void 0:n.top_p)||1,this.stop=(n==null?void 0:n.stop)||[],this.maxDisplayRounds=(n==null?void 0:n.maxDisplayRounds)||Z.xf,this.maxMemoryRounds=(n==null?void 0:n.maxMemoryRounds)||Z.DI,u.abrupt("return",n);case 17:case"end":return u.stop()}},g,this)}));function e(){return m.apply(this,arguments)}return e}()},{key:"getHistory",value:function(){var m=C()(_()().mark(function g(n){return _()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,E.db.getDataByIndex("BotHistories","botId",n);case 2:return u.abrupt("return",u.sent);case 3:case"end":return u.stop()}},g)}));function e(g){return m.apply(this,arguments)}return e}()}],[{key:"getAll",value:function(){var m=C()(_()().mark(function g(){return _()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,E.db.getAllData("Bots");case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}},g)}));function e(){return m.apply(this,arguments)}return e}()}]),o}();te.Z=z}}]);
