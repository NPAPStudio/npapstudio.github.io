"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[136],{65136:function(Pe,oe,t){t.d(oe,{z:function(){return ke.z},Z:function(){return ht}});var ie=t(52677),E=t.n(ie),ue=t(19632),U=t.n(ue),le=t(97857),f=t.n(le),de=t(15009),R=t.n(de),ce=t(99289),G=t.n(ce),he=t(5574),o=t.n(he),N=t(97937),L=t(16801),me=t(27496),X=t(52745),b=t(25278),y=t(86250),h=t(14726),n=t(2058),a=t(67294),l={sendBoxWrapper:"sendBoxWrapper___agwkd",uploadedImg:"uploadedImg___ZqD9c",removeImg:"removeImg___ZBJvT"},e=t(85893),A=b.Z.TextArea;function Be(x){var d=x.onSend,_=x.sending,I=x.onHeightChanged,P=(0,a.useState)(""),i=o()(P,2),j=i[0],m=i[1],T=(0,a.useState)(""),Z=o()(T,2),B=Z[0],w=Z[1],K=(0,a.useState)(!1),$=o()(K,2),V=$[0],z=$[1];(0,a.useEffect)(function(){},[_]);var ee=function(v){m(v.target.value),I&&I(v.target.scrollHeight)},te=function(){_||(d(j,B),m(""),w(""))},ne=function(v){v.key==="Enter"&&!V&&!v.shiftKey&&!v.ctrlKey&&!v.altKey&&(v.preventDefault(),te()),(v.key==="Enter"&&v.altKey||v.key==="Enter"&&v.ctrlKey)&&m(j+`
`)},Y=function(){z(!0)},ae=function(){z(!1)},_e=function(){w("")},re=function(v){if(v.file){var F=new FileReader;F.onload=function(ge){var Q,O=(Q=ge.target)===null||Q===void 0?void 0:Q.result;typeof O=="string"&&w(O)},F.readAsDataURL(v.file)}};return(0,e.jsx)(y.Z,{style:{width:"100%"},justify:"center",align:"center",children:(0,e.jsxs)(y.Z,{className:l.sendBoxWrapper,children:[B?(0,e.jsxs)("div",{className:l.uploadedImg,children:[(0,e.jsx)("img",{src:B}),(0,e.jsx)(h.ZP,{className:l.removeImg,type:"default",icon:(0,e.jsx)(N.Z,{}),shape:"circle",onClick:_e})]}):"",(0,e.jsx)(n.Z,{beforeUpload:function(){return!1},onChange:re,showUploadList:!1,children:(0,e.jsx)(h.ZP,{type:"default",icon:(0,e.jsx)(L.Z,{}),shape:"circle"})}),(0,e.jsx)(A,{rows:1,placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",autoSize:{minRows:1,maxRows:5},onChange:ee,onKeyDown:ne,onCompositionStart:Y,onCompositionEnd:ae,value:j}),(0,e.jsx)(h.ZP,{style:{marginLeft:"10px"},type:"primary",icon:_?(0,e.jsx)(X.Z,{}):(0,e.jsx)(me.Z,{}),shape:"circle",onClick:te})]})})}var Le=Be,ve=t(88001),Ae=t(80882),be=t(47988),Te={modelSwitcher:"modelSwitcher___q1h_3"},Ue=function(d){var _=d.currentModel,I=d.onChange,P=(0,a.useState)(""),i=o()(P,2),j=i[0],m=i[1];(0,a.useEffect)(function(){var B=ve.aH.find(function(w){return w.key===_});B&&m(B.label)},[_]);var T=function(w){var K=w.key,$=ve.aH.find(function(V){return V.key===K});$&&(m($.label),I&&I(K))},Z={onClick:T,items:ve.aH.map(function(B){return{key:B.key,label:B.label}})};return(0,e.jsx)(be.Z,{menu:Z,className:Te.modelSwitcher,children:(0,e.jsxs)(h.ZP,{size:"large",style:{border:"none"},children:[j," ",(0,e.jsx)(Ae.Z,{})]})})},Re=Ue,we=Re,Oe=t(16165),Ze=function(){return(0,e.jsx)("svg",{viewBox:"0 0 1024 1024",width:"1em",height:"1em",fill:"currentColor",children:(0,e.jsx)("path",{d:"M89.6 806.4h844.8V217.6H89.6v588.8zM0 128h1024v768H0V128z m242.816 577.536L192 654.72l154.304-154.368L192 346.048l50.816-50.816L448 500.352l-205.184 205.184z m584.32 13.248H512V640h315.072v78.72z"})})},je=function(d){return(0,e.jsx)(Oe.Z,f()({component:Ze},d))},Mt={TerminalIcon:je},xt=null,Et=null,ke=t(41467),pe=t(67984),Ne=t(9981),J=t(21612),H={chatLayout:"chatLayout___mSyN7",mainChatLayout:"mainChatLayout___UtmAb",mainChatLayoutHeader:"mainChatLayoutHeader___kNAhD",mainChatLayoutContent:"mainChatLayoutContent___soSU_",mainChatLayoutFooter:"mainChatLayoutFooter___PcPty",usageTips:"usageTips___UbHGs",mainChatRightSidebarTrigger:"mainChatRightSidebarTrigger___MmoUG",GenerateBot:"GenerateBot___n17Sp"},He=t(48689),We=t(87547),Ke=t(89705),$e=t(8718),ze=t(13769),Fe=t.n(ze),Ge=t(57132),Je=t(84526),Ve=t(93179),Qe=t(68806),Se={codeWrapper:"codeWrapper___TPzJT",copyButton:"copyButton___X2UZT"},Xe=["children","className"],Ye=function(d){var _=d.code,I=function(){navigator.clipboard.writeText(_).then(function(){},function(i){console.error("Failed to copy code: ",i)})};return(0,e.jsx)(h.ZP,{icon:(0,e.jsx)(Ge.Z,{}),size:"small",type:"text",className:Se.copyButton,onClick:I})},qe=function(d){var _=d.content;return(0,e.jsx)(Je.U,{components:{code:function(P){var i=P.children,j=P.className,m=Fe()(P,Xe),T=/language-(\w+)/.exec(j||""),Z=String(i).replace(/\n$/,"");return T?(0,e.jsxs)("div",{className:Se.codeWrapper,children:[(0,e.jsx)(Ye,{code:Z}),(0,e.jsx)(Ve.Z,f()(f()({},m),{},{PreTag:"div",language:T[1],style:Qe.Z,wrapLines:!0,ref:a.createRef(),children:Z}))]}):(0,e.jsx)("code",f()(f()({},m),{},{className:j,children:i}))}},children:_})},et=qe,Me=et,W={mainMsgList:"mainMsgList___yzBZj",chatItem:"chatItem___U_uOO",chatContent:"chatContent___rJQDh",moreActionBtn:"moreActionBtn___aiJEA",userContent:"userContent___LOQQq",assistantContent:"assistantContent___iIkx1",avatar:"avatar___uSme5"};function tt(x){var d=x.messages,_=x.handleMsgAction,I=function(j,m){console.log(j,m),_&&_(j,m)},P=[{icon:(0,e.jsx)(He.Z,{}),key:"delete",danger:!0,label:"Delete"}];return(0,a.useEffect)(function(){var i=document.querySelector(".".concat(W.mainMsgList));i&&(i.scrollTop=i.scrollHeight)},[d]),(0,e.jsx)("div",{className:W.mainMsgList,children:d.map(function(i,j){return(0,e.jsxs)(y.Z,{gap:"middle",justify:i.isUser?"end":"start",align:"start",className:W.chatItem,children:[i.isUser?"":(0,e.jsx)($e.C,{size:36,icon:(0,e.jsx)(We.Z,{}),className:W.avatar}),(0,e.jsxs)("span",{className:"".concat(W.chatContent," ").concat(i.isUser?W.userContent:W.assistantContent),children:[typeof i.content=="string"?(0,e.jsx)(Me,{content:i.content}):i.content.map(function(m){if(m.type==="text")return(0,e.jsx)(Me,{content:m.text});if(m.type==="image_url")return(0,e.jsx)("img",{src:m.image_url.url})}),(0,e.jsx)(be.Z,{menu:{selectable:!1,onClick:function(T){I(T.key,i.id)},items:P},trigger:["hover"],className:W.moreActionBtn,children:(0,e.jsx)(h.ZP,{icon:(0,e.jsx)(Ke.Z,{}),size:"small",type:"text"})})]})]},j)})})}var nt=tt,at=t(22913),xe={promptEditor:"promptEditor___I7WRr",systemPromotTextarea:"systemPromotTextarea___xJfXE"};function rt(x){var d=x.prompt,_=x.onPromptChange,I=function(i){_(i.target.value)};return(0,e.jsxs)(y.Z,{className:xe.promptEditor,vertical:!0,children:[(0,e.jsx)("h3",{children:"System Prompt"}),(0,e.jsx)(at.Z,{className:xe.systemPromotTextarea,value:d,onChange:I})]})}var st=rt,ot=J.Z.Header,it=J.Z.Footer,ut=J.Z.Sider,lt=J.Z.Content,dt=function(d){var _,I=d.chat,P=d.bot,i=d.model,j=d.type,m=d.chatIdUpdate,T=d.messageHandler,Z=(0,a.useState)(!1),B=o()(Z,2),w=B[0],K=B[1],$=(0,a.useState)(""),V=o()($,2),z=V[0],ee=V[1],te=(0,a.useState)(i),ne=o()(te,2),Y=ne[0],ae=ne[1],_e=(0,a.useState)([]),re=o()(_e,2),k=re[0],v=re[1],F=I,ge=(0,a.useState)(P),Q=o()(ge,2),O=Q[0],fe=Q[1],mt=(0,a.useState)(new pe.Z(O)),Ee=o()(mt,2),q=Ee[0],ye=Ee[1],vt=(0,a.useRef)(new Ne.Z(F)),pt=(0,a.useState)(vt.current),_t=o()(pt,1),r=_t[0],gt=(0,a.useState)(null),Ie=o()(gt,2),se=Ie[0],Ce=Ie[1],ft=function(S){ae(S),r.chat&&r.changeModel(S)},De=function(){var c=G()(R()().mark(function S(){var M,g,D;return R()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(s.prev=0,!q){s.next=8;break}if(!(O||(M=r.chat)!==null&&M!==void 0&&M.botId)){s.next=8;break}return q.setId(O||((g=r.chat)===null||g===void 0?void 0:g.botId)),s.next=6,q.get();case 6:D=s.sent,ye(D);case 8:s.next=14;break;case 10:s.prev=10,s.t0=s.catch(0),fe(void 0),ye(new pe.Z);case 14:case"end":return s.stop()}},S,null,[[0,10]])}));return function(){return c.apply(this,arguments)}}(),yt=function(){var c=G()(R()().mark(function S(){var M,g,D,p,s;return R()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!F){C.next=11;break}return r.setId(F),C.next=4,r.init(j,Y);case 4:if(p=r.messages.map(function(St){return St}),ae((M=r.chat)===null||M===void 0?void 0:M.model),v(p),r!=null&&(g=r.chat)!==null&&g!==void 0&&g.title){C.next=10;break}return C.next=10,r.generateChatName();case 10:(D=r.chat)!==null&&D!==void 0&&D.botId?(fe((s=r.chat)===null||s===void 0?void 0:s.botId),De()):(fe(void 0),ye(new pe.Z));case 11:case"end":return C.stop()}},S)}));return function(){return c.apply(this,arguments)}}();(0,a.useEffect)(function(){console.log("usage:",z);var c=localStorage.getItem("lastUsage");!z&&c&&ee(c)},[z]),(0,a.useEffect)(function(){yt()},[F]),(0,a.useEffect)(function(){De()},[O]),(0,a.useEffect)(function(){var c=function(s){Ce(function(u){var C=u?f()(f()({},u),{},{content:u.content+s.detail}):{chatId:r.id,content:s.detail,createdAt:new Date,isUser:!1};return C})},S=function(s){T&&T(s.detail)},M=function(s){Ce(function(u){var C=u?f()(f()({},u),{},{id:s.detail}):{chatId:r.id,content:s.detail,createdAt:new Date,isUser:!1};return C})},g=function(s){v(function(u){return u.map(function(C){return!C.id&&C.isUser?f()(f()({},C),{},{id:s.detail}):C})})},D=function(s){console.log(s.detail);var u="Tokens: ".concat(s.detail.prompt_tokens," / ").concat(s.detail.completion_tokens," / ").concat(s.detail.total_tokens);localStorage.setItem("lastUsage",u),ee(u)};return r.addEventListener("messageReceived",c),r.addEventListener("messageReceivedDone",S),r.addEventListener("userMessageId",g),r.addEventListener("assistantMessageId",M),r.addEventListener("usageReceived",D),function(){r.removeEventListener("messageReceived",c),r.removeEventListener("messageReceivedDone",S),r.removeEventListener("userMessageId",g),r.removeEventListener("assistantMessageId",M),r.removeEventListener("usageReceived",D)}},[r]),(0,a.useEffect)(function(){se&&v(function(c){return c.length>0&&!c[c.length-1].isUser?[].concat(U()(c.slice(0,c.length-1)),[se]):[].concat(U()(c),[se])})},[se]);var Ct=(0,e.jsx)(je,{className:H.mainChatRightSidebarTrigger}),bt=function(){var c=G()(R()().mark(function S(M,g){var D,p;return R()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!w){u.next=2;break}return u.abrupt("return");case 2:if(!(!M&&!g)){u.next=4;break}return u.abrupt("return");case 4:if(K(!0),D=!1,r.chat){u.next=11;break}return O&&r.setBot(O),u.next=10,r.init(j,Y);case 10:D=!0;case 11:return p={chatId:r.id,content:[{type:"text",text:M}],createdAt:new Date,isUser:!0},g&&E()(p.content)==="object"&&p.content.push({type:"image_url",image_url:{detail:"low",url:g}}),v(function(C){return[].concat(U()(C),[p])}),Ce({chatId:r.id,content:[],createdAt:new Date,isUser:!1}),u.next=17,r.sendMessage(p.content);case 17:K(!1),D&&m&&r.id&&m(r.id);case 19:case"end":return u.stop()}},S)}));return function(M,g){return c.apply(this,arguments)}}(),jt=function(){var c=G()(R()().mark(function S(M,g){return R()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(M!=="delete"){p.next=5;break}if(!g){p.next=5;break}return p.next=4,r.deleteMessage(g);case 4:v(r.messages.map(function(s){return s}));case 5:case"end":return p.stop()}},S)}));return function(M,g){return c.apply(this,arguments)}}();return(0,e.jsxs)(J.Z,{className:"".concat(H.chatLayout," ").concat(H[j]),children:[(0,e.jsxs)(J.Z,{className:H.mainChatLayout,children:[(0,e.jsx)(ot,{className:H.mainChatLayoutHeader,children:O?(0,e.jsx)("h2",{children:q.title}):(0,e.jsx)(we,{currentModel:Y,onChange:ft})}),(0,e.jsx)(lt,{className:H.mainChatLayoutContent,children:(0,e.jsx)(nt,{messages:k,handleMsgAction:jt})}),(0,e.jsx)(it,{className:H.mainChatLayoutFooter,children:(0,e.jsx)(Le,{onSend:bt,sending:w})}),(0,e.jsx)("div",{className:H.usageTips,children:z})]}),(0,e.jsx)(ut,{style:{backgroundColor:"rgba(0,0,0,0)",borderLeft:"1px solid #f0f0f0"},collapsible:!0,defaultCollapsed:!0,reverseArrow:!0,width:500,collapsedWidth:0,zeroWidthTriggerStyle:{width:30,height:30,borderRadius:0,top:0,left:-30,backgroundColor:"rgba(0,0,0,0)"},trigger:Ct,children:(0,e.jsx)(st,{prompt:((_=r.chat)===null||_===void 0?void 0:_.systemPrompt)||q.systemPrompt,onPromptChange:function(){}})})]})},ct=dt,ht=ct},67984:function(Pe,oe,t){var ie=t(15009),E=t.n(ie),ue=t(97857),U=t.n(ue),le=t(99289),f=t.n(le),de=t(12444),R=t.n(de),ce=t(72004),G=t.n(ce),he=t(9783),o=t.n(he),N=t(88001),L=t(41467),me=function(){function X(b){R()(this,X),o()(this,"id",void 0),o()(this,"title",void 0),o()(this,"createdAt",void 0),o()(this,"systemPrompt",void 0),o()(this,"model",void 0),o()(this,"helperChatId",void 0),o()(this,"frequency_penalty",void 0),o()(this,"presence_penalty",void 0),o()(this,"max_tokens",void 0),o()(this,"temperature",void 0),o()(this,"top_p",void 0),o()(this,"stop",void 0),o()(this,"maxDisplayRounds",void 0),o()(this,"maxMemoryRounds",void 0),b?this.id=parseInt(b):(this.title="",this.createdAt=new Date,this.systemPrompt="",this.model=N.pk,this.frequency_penalty=0,this.presence_penalty=0,this.temperature=1,this.top_p=1,this.stop=[],this.maxDisplayRounds=N.xf,this.maxMemoryRounds=N.DI)}return G()(X,[{key:"setId",value:function(y){this.id=parseInt(y)}},{key:"create",value:function(){var b=f()(E()().mark(function h(n){var a,l;return E()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,L.db.addData("Bots",n);case 2:return a=A.sent,this.id=a,l=U()(U()({},n),{},{botId:this.id,updateAt:new Date}),A.next=7,L.db.addData("BotHistories",l);case 7:return A.next=9,this.get();case 9:return A.abrupt("return",A.sent);case 10:case"end":return A.stop()}},h,this)}));function y(h){return b.apply(this,arguments)}return y}()},{key:"update",value:function(){var b=f()(E()().mark(function h(n){var a;return E()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.id){e.next=2;break}throw new Error("Bot id is required");case 2:return e.next=4,L.db.updateData("Bots",U()(U()({},n),{},{id:this.id}));case 4:return a=U()(U()({},n),{},{botId:this.id,updateAt:new Date}),e.next=7,L.db.addData("BotHistories",a);case 7:return e.next=9,this.get();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},h,this)}));function y(h){return b.apply(this,arguments)}return y}()},{key:"delete",value:function(){var b=f()(E()().mark(function h(){return E()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this.id){a.next=2;break}throw new Error("Bot id is required");case 2:return a.next=4,L.db.deleteData("Bots",this.id);case 4:return a.next=6,L.db.deleteDataByIndex("BotHistories","botId",this.id);case 6:case"end":return a.stop()}},h,this)}));function y(){return b.apply(this,arguments)}return y}()},{key:"get",value:function(){var b=f()(E()().mark(function h(){var n;return E()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.id){l.next=2;break}throw new Error("Bot id is required");case 2:return l.next=4,L.db.getData("Bots",this.id);case 4:return n=l.sent,this.title=(n==null?void 0:n.title)||"",this.createdAt=(n==null?void 0:n.createdAt)||new Date,this.systemPrompt=(n==null?void 0:n.systemPrompt)||"",this.model=(n==null?void 0:n.model)||N.pk,this.frequency_penalty=(n==null?void 0:n.frequency_penalty)||0,this.presence_penalty=(n==null?void 0:n.presence_penalty)||0,this.temperature=(n==null?void 0:n.temperature)||1,this.top_p=(n==null?void 0:n.top_p)||1,this.stop=(n==null?void 0:n.stop)||[],this.maxDisplayRounds=(n==null?void 0:n.maxDisplayRounds)||N.xf,this.maxMemoryRounds=(n==null?void 0:n.maxMemoryRounds)||N.DI,l.abrupt("return",n);case 17:case"end":return l.stop()}},h,this)}));function y(){return b.apply(this,arguments)}return y}()},{key:"getHistory",value:function(){var b=f()(E()().mark(function h(n){return E()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,L.db.getDataByIndex("BotHistories","botId",n);case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},h)}));function y(h){return b.apply(this,arguments)}return y}()}],[{key:"getAll",value:function(){var b=f()(E()().mark(function h(){return E()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,L.db.getAllData("Bots");case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},h)}));function y(){return b.apply(this,arguments)}return y}()}]),X}();oe.Z=me}}]);
