"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[136],{65136:function(Ee,re,t){t.d(re,{z:function(){return Oe.z},Z:function(){return lt}});var se=t(52677),E=t.n(se),oe=t(19632),T=t.n(oe),ie=t(97857),g=t.n(ie),ue=t(15009),R=t.n(ue),le=t(99289),F=t.n(le),de=t(5574),i=t.n(de),k=t(97937),B=t(16801),ce=t(27496),q=t(52745),C=t(25278),y=t(86250),h=t(14726),n=t(2058),a=t(67294),d={sendBoxWrapper:"sendBoxWrapper___agwkd",uploadedImg:"uploadedImg___ZqD9c",removeImg:"removeImg___ZBJvT"},e=t(85893),L=C.Z.TextArea;function Ie(x){var c=x.onSend,p=x.sending,I=x.onHeightChanged,D=(0,a.useState)(""),s=i()(D,2),b=s[0],m=s[1],A=(0,a.useState)(""),U=i()(A,2),P=U[0],w=U[1],K=(0,a.useState)(!1),$=i()(K,2),J=$[0],V=$[1];(0,a.useEffect)(function(){},[p]);var ee=function(l){m(l.target.value),I&&I(l.target.scrollHeight)},te=function(){p||(c(b,P),m(""),w(""))},ne=function(l){l.key==="Enter"&&!J&&!l.shiftKey&&!l.ctrlKey&&!l.altKey&&(l.preventDefault(),te()),(l.key==="Enter"&&l.altKey||l.key==="Enter"&&l.ctrlKey)&&m(b+`
`)},ve=function(){V(!0)},z=function(){V(!1)},Q=function(){w("")},pe=function(l){if(l.file){var X=new FileReader;X.onload=function(_e){var Y,W=(Y=_e.target)===null||Y===void 0?void 0:Y.result;typeof W=="string"&&w(W)},X.readAsDataURL(l.file)}};return(0,e.jsx)(y.Z,{style:{width:"100%"},justify:"center",align:"center",children:(0,e.jsxs)(y.Z,{className:d.sendBoxWrapper,children:[P?(0,e.jsxs)("div",{className:d.uploadedImg,children:[(0,e.jsx)("img",{src:P}),(0,e.jsx)(h.ZP,{className:d.removeImg,type:"default",icon:(0,e.jsx)(k.Z,{}),shape:"circle",onClick:Q})]}):"",(0,e.jsx)(n.Z,{beforeUpload:function(){return!1},onChange:pe,showUploadList:!1,children:(0,e.jsx)(h.ZP,{type:"default",icon:(0,e.jsx)(B.Z,{}),shape:"circle"})}),(0,e.jsx)(L,{rows:1,placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",autoSize:{minRows:1,maxRows:5},onChange:ee,onKeyDown:ne,onCompositionStart:ve,onCompositionEnd:z,value:b}),(0,e.jsx)(h.ZP,{style:{marginLeft:"10px"},type:"primary",icon:p?(0,e.jsx)(q.Z,{}):(0,e.jsx)(ce.Z,{}),shape:"circle",onClick:te})]})})}var De=Ie,he=t(88001),Pe=t(80882),ye=t(47988),Be={modelSwitcher:"modelSwitcher___q1h_3"},Le=function(c){var p=c.currentModel,I=c.onChange,D=(0,a.useState)(""),s=i()(D,2),b=s[0],m=s[1];(0,a.useEffect)(function(){var P=he.aH.find(function(w){return w.key===p});P&&m(P.label)},[p]);var A=function(w){var K=w.key,$=he.aH.find(function(J){return J.key===K});$&&(m($.label),I&&I(K))},U={onClick:A,items:he.aH.map(function(P){return{key:P.key,label:P.label}})};return(0,e.jsx)(ye.Z,{menu:U,className:Be.modelSwitcher,children:(0,e.jsxs)(h.ZP,{size:"large",style:{border:"none"},children:[b," ",(0,e.jsx)(Pe.Z,{})]})})},Ae=Le,Te=Ae,Re=t(16165),we=function(){return(0,e.jsx)("svg",{viewBox:"0 0 1024 1024",width:"1em",height:"1em",fill:"currentColor",children:(0,e.jsx)("path",{d:"M89.6 806.4h844.8V217.6H89.6v588.8zM0 128h1024v768H0V128z m242.816 577.536L192 654.72l154.304-154.368L192 346.048l50.816-50.816L448 500.352l-205.184 205.184z m584.32 13.248H512V640h315.072v78.72z"})})},Ce=function(c){return(0,e.jsx)(Re.Z,g()({component:we},c))},Ct={TerminalIcon:Ce},bt=null,jt=null,Oe=t(41467),me=t(67984),Ue=t(9981),G=t(21612),H={chatLayout:"chatLayout___mSyN7",mainChatLayout:"mainChatLayout___UtmAb",mainChatLayoutHeader:"mainChatLayoutHeader___kNAhD",mainChatLayoutContent:"mainChatLayoutContent___soSU_",mainChatLayoutFooter:"mainChatLayoutFooter___PcPty",mainChatRightSidebarTrigger:"mainChatRightSidebarTrigger___MmoUG",GenerateBot:"GenerateBot___n17Sp"},Ze=t(48689),ke=t(87547),Ne=t(89705),We=t(8718),He=t(13769),Ke=t.n(He),$e=t(57132),ze=t(84526),Fe=t(93179),Ge=t(68806),be={codeWrapper:"codeWrapper___TPzJT",copyButton:"copyButton___X2UZT"},Je=["children","className"],Ve=function(c){var p=c.code,I=function(){navigator.clipboard.writeText(p).then(function(){},function(s){console.error("Failed to copy code: ",s)})};return(0,e.jsx)(h.ZP,{icon:(0,e.jsx)($e.Z,{}),size:"small",type:"text",className:be.copyButton,onClick:I})},Qe=function(c){var p=c.content;return(0,e.jsx)(ze.U,{components:{code:function(D){var s=D.children,b=D.className,m=Ke()(D,Je),A=/language-(\w+)/.exec(b||""),U=String(s).replace(/\n$/,"");return A?(0,e.jsxs)("div",{className:be.codeWrapper,children:[(0,e.jsx)(Ve,{code:U}),(0,e.jsx)(Fe.Z,g()(g()({},m),{},{PreTag:"div",language:A[1],style:Ge.Z,wrapLines:!0,ref:a.createRef(),children:U}))]}):(0,e.jsx)("code",g()(g()({},m),{},{className:b,children:s}))}},children:p})},Xe=Qe,je=Xe,N={mainMsgList:"mainMsgList___yzBZj",chatItem:"chatItem___U_uOO",chatContent:"chatContent___rJQDh",moreActionBtn:"moreActionBtn___aiJEA",userContent:"userContent___LOQQq",assistantContent:"assistantContent___iIkx1",avatar:"avatar___uSme5"};function Ye(x){var c=x.messages,p=x.handleMsgAction,I=function(b,m){console.log(b,m),p&&p(b,m)},D=[{icon:(0,e.jsx)(Ze.Z,{}),key:"delete",danger:!0,label:"Delete"}];return(0,a.useEffect)(function(){var s=document.querySelector(".".concat(N.mainMsgList));s&&(s.scrollTop=s.scrollHeight)},[c]),(0,e.jsx)("div",{className:N.mainMsgList,children:c.map(function(s,b){return(0,e.jsxs)(y.Z,{gap:"middle",justify:s.isUser?"end":"start",align:"start",className:N.chatItem,children:[s.isUser?"":(0,e.jsx)(We.C,{size:36,icon:(0,e.jsx)(ke.Z,{}),className:N.avatar}),(0,e.jsxs)("span",{className:"".concat(N.chatContent," ").concat(s.isUser?N.userContent:N.assistantContent),children:[s.id,typeof s.content=="string"?(0,e.jsx)(je,{content:s.content}):s.content.map(function(m){if(m.type==="text")return(0,e.jsx)(je,{content:m.text});if(m.type==="image_url")return(0,e.jsx)("img",{src:m.image_url.url})}),(0,e.jsx)(ye.Z,{menu:{selectable:!1,onClick:function(A){I(A.key,s.id)},items:D},trigger:["hover"],className:N.moreActionBtn,children:(0,e.jsx)(h.ZP,{icon:(0,e.jsx)(Ne.Z,{}),size:"small",type:"text"})})]})]},b)})})}var qe=Ye,et=t(22913),Me={promptEditor:"promptEditor___I7WRr",systemPromotTextarea:"systemPromotTextarea___xJfXE"};function tt(x){var c=x.prompt,p=x.onPromptChange,I=function(s){p(s.target.value)};return(0,e.jsxs)(y.Z,{className:Me.promptEditor,vertical:!0,children:[(0,e.jsx)("h3",{children:"System Prompt"}),(0,e.jsx)(et.Z,{className:Me.systemPromotTextarea,value:c,onChange:I})]})}var nt=tt,at=G.Z.Header,rt=G.Z.Footer,st=G.Z.Sider,ot=G.Z.Content,it=function(c){var p,I=c.chat,D=c.bot,s=c.model,b=c.type,m=c.chatIdUpdate,A=c.messageHandler,U=(0,a.useState)(!1),P=i()(U,2),w=P[0],K=P[1],$=(0,a.useState)(s),J=i()($,2),V=J[0],ee=J[1],te=(0,a.useState)([]),ne=i()(te,2),ve=ne[0],z=ne[1],Q=I,pe=(0,a.useState)(D),O=i()(pe,2),l=O[0],X=O[1],_e=(0,a.useState)(new me.Z(l)),Y=i()(_e,2),W=Y[0],fe=Y[1],dt=(0,a.useRef)(new Ue.Z(Q)),ct=(0,a.useState)(dt.current),ht=i()(ct,1),r=ht[0],mt=(0,a.useState)(null),xe=i()(mt,2),ae=xe[0],ge=xe[1],vt=function(j){ee(j),r.chat&&r.changeModel(j)},Se=function(){var _=F()(R()().mark(function j(){var M,f,S;return R()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,!W){o.next=8;break}if(!(l||(M=r.chat)!==null&&M!==void 0&&M.botId)){o.next=8;break}return W.setId(l||((f=r.chat)===null||f===void 0?void 0:f.botId)),o.next=6,W.get();case 6:S=o.sent,fe(S);case 8:o.next=14;break;case 10:o.prev=10,o.t0=o.catch(0),X(void 0),fe(new me.Z);case 14:case"end":return o.stop()}},j,null,[[0,10]])}));return function(){return _.apply(this,arguments)}}(),pt=function(){var _=F()(R()().mark(function j(){var M,f,S,u,o;return R()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(!Q){Z.next=11;break}return r.setId(Q),Z.next=4,r.init(b,V);case 4:if(u=r.messages.map(function(yt){return yt}),ee((M=r.chat)===null||M===void 0?void 0:M.model),z(u),r!=null&&(f=r.chat)!==null&&f!==void 0&&f.title){Z.next=10;break}return Z.next=10,r.generateChatName();case 10:(S=r.chat)!==null&&S!==void 0&&S.botId?(X((o=r.chat)===null||o===void 0?void 0:o.botId),Se()):(X(void 0),fe(new me.Z));case 11:case"end":return Z.stop()}},j)}));return function(){return _.apply(this,arguments)}}();(0,a.useEffect)(function(){pt()},[Q]),(0,a.useEffect)(function(){Se()},[l]),(0,a.useEffect)(function(){var _=function(u){ge(function(o){var v=o?g()(g()({},o),{},{content:o.content+u.detail}):{chatId:r.id,content:u.detail,createdAt:new Date,isUser:!1};return v})},j=function(u){A&&A(u.detail)},M=function(u){ge(function(o){var v=o?g()(g()({},o),{},{id:u.detail}):{chatId:r.id,content:u.detail,createdAt:new Date,isUser:!1};return v})},f=function(u){z(function(o){return o.map(function(v){return!v.id&&v.isUser?g()(g()({},v),{},{id:u.detail}):v})})};return r.addEventListener("messageReceived",_),r.addEventListener("messageReceivedDone",j),r.addEventListener("userMessageId",f),r.addEventListener("assistantMessageId",M),function(){r.removeEventListener("messageReceived",_),r.removeEventListener("messageReceivedDone",j),r.removeEventListener("userMessageId",f),r.removeEventListener("assistantMessageId",M)}},[r]),(0,a.useEffect)(function(){ae&&z(function(_){return _.length>0&&!_[_.length-1].isUser?[].concat(T()(_.slice(0,_.length-1)),[ae]):[].concat(T()(_),[ae])})},[ae]);var _t=(0,e.jsx)(Ce,{className:H.mainChatRightSidebarTrigger}),ft=function(){var _=F()(R()().mark(function j(M,f){var S,u;return R()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!w){v.next=2;break}return v.abrupt("return");case 2:if(!(!M&&!f)){v.next=4;break}return v.abrupt("return");case 4:if(K(!0),S=!1,r.chat){v.next=11;break}return l&&r.setBot(l),v.next=10,r.init(b,V);case 10:S=!0;case 11:return u={chatId:r.id,content:[{type:"text",text:M}],createdAt:new Date,isUser:!0},f&&E()(u.content)==="object"&&u.content.push({type:"image_url",image_url:{detail:"low",url:f}}),z(function(Z){return[].concat(T()(Z),[u])}),ge({chatId:r.id,content:[],createdAt:new Date,isUser:!1}),v.next=17,r.sendMessage(u.content);case 17:K(!1),S&&m&&r.id&&m(r.id);case 19:case"end":return v.stop()}},j)}));return function(M,f){return _.apply(this,arguments)}}(),gt=function(){var _=F()(R()().mark(function j(M,f){return R()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(M!=="delete"){u.next=5;break}if(!f){u.next=5;break}return u.next=4,r.deleteMessage(f);case 4:z(r.messages.map(function(o){return o}));case 5:case"end":return u.stop()}},j)}));return function(M,f){return _.apply(this,arguments)}}();return(0,e.jsxs)(G.Z,{className:"".concat(H.chatLayout," ").concat(H[b]),children:[(0,e.jsxs)(G.Z,{className:H.mainChatLayout,children:[(0,e.jsx)(at,{className:H.mainChatLayoutHeader,children:l?(0,e.jsx)("h2",{children:W.title}):(0,e.jsx)(Te,{currentModel:V,onChange:vt})}),(0,e.jsx)(ot,{className:H.mainChatLayoutContent,children:(0,e.jsx)(qe,{messages:ve,handleMsgAction:gt})}),(0,e.jsx)(rt,{className:H.mainChatLayoutFooter,children:(0,e.jsx)(De,{onSend:ft,sending:w})})]}),(0,e.jsx)(st,{style:{backgroundColor:"rgba(0,0,0,0)",borderLeft:"1px solid #f0f0f0"},collapsible:!0,defaultCollapsed:!0,reverseArrow:!0,width:500,collapsedWidth:0,zeroWidthTriggerStyle:{width:30,height:30,borderRadius:0,top:0,left:-30,backgroundColor:"rgba(0,0,0,0)"},trigger:_t,children:(0,e.jsx)(nt,{prompt:((p=r.chat)===null||p===void 0?void 0:p.systemPrompt)||W.systemPrompt,onPromptChange:function(){}})})]})},ut=it,lt=ut},67984:function(Ee,re,t){var se=t(15009),E=t.n(se),oe=t(97857),T=t.n(oe),ie=t(99289),g=t.n(ie),ue=t(12444),R=t.n(ue),le=t(72004),F=t.n(le),de=t(9783),i=t.n(de),k=t(88001),B=t(41467),ce=function(){function q(C){R()(this,q),i()(this,"id",void 0),i()(this,"title",void 0),i()(this,"createdAt",void 0),i()(this,"systemPrompt",void 0),i()(this,"model",void 0),i()(this,"helperChatId",void 0),i()(this,"frequency_penalty",void 0),i()(this,"presence_penalty",void 0),i()(this,"max_tokens",void 0),i()(this,"temperature",void 0),i()(this,"top_p",void 0),i()(this,"stop",void 0),i()(this,"maxDisplayRounds",void 0),i()(this,"maxMemoryRounds",void 0),C?this.id=parseInt(C):(this.title="",this.createdAt=new Date,this.systemPrompt="",this.model=k.pk,this.frequency_penalty=0,this.presence_penalty=0,this.temperature=1,this.top_p=1,this.stop=[],this.maxDisplayRounds=k.xf,this.maxMemoryRounds=k.DI)}return F()(q,[{key:"setId",value:function(y){this.id=parseInt(y)}},{key:"create",value:function(){var C=g()(E()().mark(function h(n){var a,d;return E()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,B.db.addData("Bots",n);case 2:return a=L.sent,this.id=a,d=T()(T()({},n),{},{botId:this.id,updateAt:new Date}),L.next=7,B.db.addData("BotHistories",d);case 7:return L.next=9,this.get();case 9:return L.abrupt("return",L.sent);case 10:case"end":return L.stop()}},h,this)}));function y(h){return C.apply(this,arguments)}return y}()},{key:"update",value:function(){var C=g()(E()().mark(function h(n){var a;return E()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.id){e.next=2;break}throw new Error("Bot id is required");case 2:return e.next=4,B.db.updateData("Bots",T()(T()({},n),{},{id:this.id}));case 4:return a=T()(T()({},n),{},{botId:this.id,updateAt:new Date}),e.next=7,B.db.addData("BotHistories",a);case 7:return e.next=9,this.get();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},h,this)}));function y(h){return C.apply(this,arguments)}return y}()},{key:"delete",value:function(){var C=g()(E()().mark(function h(){return E()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this.id){a.next=2;break}throw new Error("Bot id is required");case 2:return a.next=4,B.db.deleteData("Bots",this.id);case 4:return a.next=6,B.db.deleteDataByIndex("BotHistories","botId",this.id);case 6:case"end":return a.stop()}},h,this)}));function y(){return C.apply(this,arguments)}return y}()},{key:"get",value:function(){var C=g()(E()().mark(function h(){var n;return E()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.id){d.next=2;break}throw new Error("Bot id is required");case 2:return d.next=4,B.db.getData("Bots",this.id);case 4:return n=d.sent,this.title=(n==null?void 0:n.title)||"",this.createdAt=(n==null?void 0:n.createdAt)||new Date,this.systemPrompt=(n==null?void 0:n.systemPrompt)||"",this.model=(n==null?void 0:n.model)||k.pk,this.frequency_penalty=(n==null?void 0:n.frequency_penalty)||0,this.presence_penalty=(n==null?void 0:n.presence_penalty)||0,this.temperature=(n==null?void 0:n.temperature)||1,this.top_p=(n==null?void 0:n.top_p)||1,this.stop=(n==null?void 0:n.stop)||[],this.maxDisplayRounds=(n==null?void 0:n.maxDisplayRounds)||k.xf,this.maxMemoryRounds=(n==null?void 0:n.maxMemoryRounds)||k.DI,d.abrupt("return",n);case 17:case"end":return d.stop()}},h,this)}));function y(){return C.apply(this,arguments)}return y}()},{key:"getHistory",value:function(){var C=g()(E()().mark(function h(n){return E()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,B.db.getDataByIndex("BotHistories","botId",n);case 2:return d.abrupt("return",d.sent);case 3:case"end":return d.stop()}},h)}));function y(h){return C.apply(this,arguments)}return y}()}],[{key:"getAll",value:function(){var C=g()(E()().mark(function h(){return E()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,B.db.getAllData("Bots");case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},h)}));function y(){return C.apply(this,arguments)}return y}()}]),q}();re.Z=ce}}]);
